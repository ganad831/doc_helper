# Phase 1 Execution Guardrails and Red Flags

**Purpose**: Prevent scope creep and architecture drift during Phase 1 implementation

**Date**: 2026-01-22

**Related Documents**:
- [Phase 1 Execution Checklist](PHASE_1_EXECUTION_CHECKLIST.md)
- [Schema Designer Implementation Plan](IMPLEMENTATION_PLAN.md)

---

## Guardrails (Must Always Hold)

These rules are **non-negotiable** during Phase 1. Violating any of these means Phase 1 has drifted into Phase 2 or later.

### Entity Scope
- [ ] **ONLY 4 entities**: EntityDefinition, FieldDefinition, ValidationRule, RelationshipDefinition
- [ ] **NO FormulaDefinition** entity
- [ ] **NO ControlRule** entity
- [ ] **NO OutputMapping** entity

### Export/Import Prohibition
- [ ] **NO export functionality** (no buttons, no file generation, no serialization logic)
- [ ] **NO import functionality** (no file parsing, no schema loading from external sources)
- [ ] **NO export format versioning** (no version metadata, no compatibility checks)

### UI Restrictions
- [ ] **NO user-facing schema editor UI** (no create/edit/delete buttons for end users)
- [ ] **NO relationships UI** (RelationshipDefinition can be stored, but no UI for creating relationships)
- [ ] **NO template selection UI**
- [ ] **NO validation severity indicators** (no ERROR/WARNING/INFO badges)

### Validation Limits
- [ ] **NO circular dependency detection** (formulas don't exist yet)
- [ ] **NO control chain validation** (controls don't exist yet)
- [ ] **NO cascade rule safety checks** (deferred to Phase 2.1)
- [ ] **NO semantic relationship restrictions** (only referential validity required)

### Infrastructure Prohibition
- [ ] **NO export tooling** (no formatters, no serializers)
- [ ] **NO import tooling** (no parsers, no validators)
- [ ] **NO schema versioning system**
- [ ] **NO capability registry**

---

## Red Flags (Stop Immediately If Seen)

If you observe **any** of the following, stop work and review against Phase 1 scope:

### Code Red Flags
- ❌ Class named `SchemaExporter`, `ExportService`, `SchemaSerializer`
- ❌ Class named `SchemaImporter`, `ImportService`, `SchemaDeserializer`
- ❌ Class named `FormulaDefinition`, `ControlRule`, `OutputMapping`
- ❌ Method named `export_schema()`, `import_schema()`, `serialize_to_json()`
- ❌ Method named `validate_cascade_rules()`, `check_circular_dependencies()`

### UI Red Flags
- ❌ Button labeled "Export Schema", "Import Schema", "Generate Schema"
- ❌ Dialog titled "Export Options", "Import Wizard", "Template Selection"
- ❌ Form with fields for "Export Format", "Target Platform Version"
- ❌ Badge/indicator showing "ERROR", "WARNING", "INFO" severity
- ❌ Relationship creation wizard or relationship editor panel

### Data Structure Red Flags
- ❌ Fields for `export_format_version`, `schema_semantic_version`, `platform_version_min`
- ❌ Fields for `formula_expression`, `dependency_graph`, `evaluation_order`
- ❌ Fields for `control_effect_type`, `control_chain`, `max_depth`
- ❌ Fields for `output_mapping_tag`, `transformer_type`, `template_reference`
- ❌ Fields for `cascade_on_delete_strategy`, `cascade_validation_rules`

### Documentation Red Flags
- ❌ Implementation details (table schemas, column names, file paths) in Phase 1 docs
- ❌ Export/import workflow documentation
- ❌ Schema versioning strategy documentation
- ❌ User-facing schema editor user guide

### Test Red Flags
- ❌ Tests for export functionality
- ❌ Tests for import functionality
- ❌ Tests for formula evaluation
- ❌ Tests for control chain validation
- ❌ Tests for cascade rule safety

### Conversation Red Flags
- ❌ "Let's just add export for testing purposes"
- ❌ "We need versioning to track changes during development"
- ❌ "It's easier to add cascade checks now while we're building relationships"
- ❌ "Users will want to see validation warnings, not just errors"
- ❌ "We should build the relationships UI since the entity exists"

---

## Allowed Grey Areas

These activities are **acceptable** during Phase 1 but must be treated with caution. They are necessary for development but must not expand into Phase 2+ features.

### Internal Rendering (ALLOWED)
**What**: Rendering forms for EntityDefinition, FieldDefinition, ValidationRule, RelationshipDefinition entities for validation and testing.

**Why Allowed**: Phase 1 must verify that the meta-schema integrates with the platform's dynamic form system.

**Guardrails**:
- Forms must be generated by platform's standard form renderer (not custom schema editor UI)
- No special styling, no custom layouts, no "schema editor" branding
- Used only for internal testing and validation
- Not exposed as a user-facing feature

**Red Flag**: If someone calls it "Schema Designer UI" or adds "Create New Schema" menu item.

### Temporary Seed Data (ALLOWED)
**What**: Manually inserting seed data for the 4 meta-schema entities during development.

**Why Allowed**: The meta-schema must be populated to test that it works.

**Guardrails**:
- Seed data inserted via direct database operations or test fixtures
- Not generated by export/import logic
- Not versioned or tracked as "official schema"
- Clearly marked as temporary/development data

**Red Flag**: If seed data includes FormulaDefinition, ControlRule, or OutputMapping entities.

### Developer Utilities (ALLOWED)
**What**: Scripts, notebooks, or CLI commands for inspecting meta-schema state during development.

**Why Allowed**: Developers need to verify that data is stored correctly.

**Guardrails**:
- Utilities are clearly marked as development tools (not production features)
- Located in separate `dev_tools/` or `scripts/` directory
- Not integrated into application menus or workflows
- Not documented as user-facing features

**Red Flag**: If utility is called "Schema Export Tool" or adds export/import capabilities.

### Validation Messages (ALLOWED)
**What**: Clear error messages when validation fails (e.g., "Entity name must be unique").

**Why Allowed**: Phase 1 must validate meta-schema data.

**Guardrails**:
- Messages describe what is wrong, not severity level (no "ERROR:", "WARNING:", "INFO:" prefixes)
- Validation either passes or fails (no partial success states)
- No color coding, no badge icons

**Red Flag**: If messages include severity indicators or allow proceeding with warnings.

### Relationship Storage (ALLOWED)
**What**: Storing RelationshipDefinition entities in the meta-schema.

**Why Allowed**: RelationshipDefinition is part of Phase 1 meta-schema.

**Guardrails**:
- Can store relationships via direct database operations or programmatic tests
- Can retrieve relationships for validation
- **NO UI for creating relationships** (deferred to Phase 2.1)
- **NO cascade rule validation** (deferred to Phase 2.1)

**Red Flag**: If someone builds a relationship editor form or adds cascade validation logic.

---

## Phase 1 Exit Criteria (Operational)

Phase 1 is **complete** when all of the following are verifiably true:

### Functional Completion
1. ✅ Schema Designer AppType is registered and appears in AppType list
2. ✅ Can create new Schema Designer project (via platform's standard project creation)
3. ✅ Can open and save Schema Designer project
4. ✅ All 4 meta-schema entities exist and are accessible (EntityDefinition, FieldDefinition, ValidationRule, RelationshipDefinition)
5. ✅ Can store and retrieve data for all 4 entities

### Validation Completion
6. ✅ Entity name uniqueness is enforced
7. ✅ Field name uniqueness within entity is enforced
8. ✅ Field types are validated against platform-defined set
9. ✅ Constraint types are validated against platform-defined set
10. ✅ Referential integrity is enforced (fields reference valid entities, rules reference valid fields, relationships reference valid entities)

### Testing Completion
11. ✅ Unit tests for all validation rules
12. ✅ Integration tests for project creation/open/save lifecycle
13. ✅ Negative tests for invalid data (duplicate names, invalid types, broken references)

### Documentation Completion
14. ✅ Meta-schema structure is documented (what entities exist, what they represent)
15. ✅ Known limitations are documented (no export, no user-facing editor UI, no relationships UI)
16. ✅ Phase 1 completion is formally documented

### Architecture Compliance
17. ✅ Schema Designer respects AppType isolation (no privileged access to other AppTypes)
18. ✅ Schema Designer uses standard platform repository interfaces
19. ✅ No export logic, no import logic, no schema versioning

### Verification Steps
20. ✅ Review all code against "Red Flags" list - confirm none are present
21. ✅ Review all tests - confirm no Phase 2+ features are tested
22. ✅ Review all documentation - confirm no Phase 2+ features are mentioned as implemented
23. ✅ Stakeholder sign-off that Phase 1 objectives are met

---

## When to Stop

**Stop implementing Phase 1 when:**

1. All 23 exit criteria above are met
2. No red flags are present in codebase
3. Stakeholders have reviewed and approved Phase 1 deliverables
4. Phase 2 execution checklist has been created and approved

**Do NOT proceed to Phase 2 until:**

- Phase 1 formal review is complete
- All Phase 1 tests are passing
- All Phase 1 documentation is complete
- Stakeholders explicitly approve Phase 2 start

---

## Emergency Stop Conditions

**Immediately halt Phase 1 implementation if:**

1. **Scope Creep Detected**: Any Phase 2+ feature is being implemented (export, formulas, controls, output mappings)
2. **Architecture Drift**: Schema Designer gains privileged access or violates AppType isolation
3. **Semantic Feature Creep**: Adding semantic validation not specified in Phase 1 (cascade rules, self-referential restrictions, formula cycles)
4. **UI Creep**: Building user-facing schema editor UI instead of relying on platform's dynamic forms

**Recovery Actions:**
1. Stop all implementation work
2. Review against Phase 1 Execution Checklist
3. Remove any out-of-scope code
4. Document lessons learned
5. Resume Phase 1 with stricter scope discipline

---

## Quick Self-Check Questions

Ask these questions regularly during development:

**Is this Phase 1?**
- "Does this code add export or import functionality?" → **NO = Phase 1, YES = Stop**
- "Does this code add formulas or controls?" → **NO = Phase 1, YES = Stop**
- "Does this code add user-facing schema editor UI?" → **NO = Phase 1, YES = Stop**
- "Does this code add cascade validation?" → **NO = Phase 1, YES = Stop**
- "Does this code only store/retrieve meta-schema data?" → **YES = Phase 1, NO = Review**

**Is this necessary for Phase 1?**
- "Can Phase 1 be complete without this feature?" → **YES = Defer, NO = Implement**
- "Is this feature listed in Phase 1 Execution Checklist?" → **YES = Implement, NO = Defer**
- "Does this prove the meta-schema is sufficient?" → **YES = Implement, NO = Defer**

**Is this allowed grey area or scope creep?**
- "Is this internal rendering for testing?" → **YES = Allowed, NO = Review**
- "Is this temporary seed data?" → **YES = Allowed, NO = Review**
- "Is this a developer utility?" → **YES = Allowed, NO = Review**
- "Does this add user-facing features?" → **NO = Allowed, YES = Stop**

---

## Success Indicators

**Phase 1 is succeeding if:**
- Development is focused on the 4 meta-schema entities only
- No export or import code exists in codebase
- No formulas, controls, or output mappings code exists
- Validation is simple pass/fail (no severity levels)
- Schema Designer uses standard platform interfaces (no special privileges)
- All tests are for Phase 1 features only
- Documentation describes only Phase 1 scope

**Phase 1 is at risk if:**
- Conversations include "let's just add..." for Phase 2+ features
- Code includes classes or methods from "Red Flags" list
- Tests are being written for export/import functionality
- Documentation describes features not in Phase 1 scope
- Developers are uncertain about what belongs in Phase 1

---

**End of Phase 1 Guardrails and Red Flags**
